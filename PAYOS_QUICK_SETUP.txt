════════════════════════════════════════════════════════════════════════════
    🚀 PAYOS QUICK SETUP - 5 PHÚT HOÀN TẤT
════════════════════════════════════════════════════════════════════════════

📦 THÔNG TIN PAYOS CỦA ANH:

Client ID:   4bbbd884-88f2-410c-9dc8-6782980ef64f
API Key:     dd9f4ba8-cc6b-46e8-9afb-930972bf7531
Checksum:    a1e68d7351f461fa646a0fbd8f20563bcfb8080c44d50eb54df2f9ed9a0bfd7d

════════════════════════════════════════════════════════════════════════════
    📋 BƯỚC 1: THÊM ENV VARS VÀO RENDER (2 phút)
════════════════════════════════════════════════════════════════════════════

1. Vào: https://dashboard.render.com

2. Chọn service: ocr-uufr

3. Click tab: Environment

4. Thêm 3 biến (click "Add Environment Variable"):

   ┌──────────────────────────────────────────────────────────────────────┐
   │ Key:   PAYOS_CLIENT_ID                                               │
   │ Value: 4bbbd884-88f2-410c-9dc8-6782980ef64f                          │
   └──────────────────────────────────────────────────────────────────────┘

   ┌──────────────────────────────────────────────────────────────────────┐
   │ Key:   PAYOS_API_KEY                                                 │
   │ Value: dd9f4ba8-cc6b-46e8-9afb-930972bf7531                          │
   └──────────────────────────────────────────────────────────────────────┘

   ┌──────────────────────────────────────────────────────────────────────┐
   │ Key:   PAYOS_CHECKSUM_KEY                                            │
   │ Value: a1e68d7351f461fa646a0fbd8f20563bcfb8080c44d50eb54df2f9ed9a0b │
   │        fd7d                                                           │
   └──────────────────────────────────────────────────────────────────────┘

5. Click "Save Changes"

6. Chờ Render auto-deploy (2-3 phút)


════════════════════════════════════════════════════════════════════════════
    📋 BƯỚC 2: CẤU HÌNH WEBHOOK TRÊN PAYOS (2 phút)
════════════════════════════════════════════════════════════════════════════

1. Đăng nhập PayOS Dashboard:
   https://my.payos.vn/

2. Vào: Settings → Webhook (hoặc Developer → Webhook)

3. Thêm Webhook URL:

   ┌──────────────────────────────────────────────────────────────────────┐
   │ Webhook URL:                                                         │
   │ https://ocr-uufr.onrender.com/api/webhook/payos                      │
   └──────────────────────────────────────────────────────────────────────┘

4. Chọn Events (tích vào):
   ☑ Payment Success (Thanh toán thành công)
   ☑ Payment Cancelled (Hủy thanh toán)  
   ☑ Payment Failed (Thanh toán thất bại)

5. Click "Save" hoặc "Update"


════════════════════════════════════════════════════════════════════════════
    📋 BƯỚC 3: TEST PAYOS INTEGRATION (1 phút)
════════════════════════════════════════════════════════════════════════════

Chạy script test trong PowerShell:

    powershell -ExecutionPolicy Bypass -File test_payos_payment.ps1


HOẶC test bằng curl:

    curl https://ocr-uufr.onrender.com/api/debug/payos-config


Kết quả mong đợi:
    {
      "payos_enabled": true,
      "client_id": "4bbbd884-88f2-410c-9dc8-6782980ef64f",
      "config_status": "OK"
    }


════════════════════════════════════════════════════════════════════════════
    📋 BƯỚC 4: TEST THANH TOÁN THỰC TẾ
════════════════════════════════════════════════════════════════════════════

1. Chạy script test_payos_payment.ps1

2. Copy QR Code URL từ kết quả

3. Mở URL trong trình duyệt → Hiện QR code

4. Scan QR bằng app ngân hàng → Thanh toán

5. Sau khi thanh toán:
   ✅ PayOS tự động gọi webhook
   ✅ License key tự động được tạo
   ✅ Email tự động gửi đến khách hàng
   ✅ Hoàn tất!


════════════════════════════════════════════════════════════════════════════
    🎯 FLOW TỰ ĐỘNG SAU KHI SETUP
════════════════════════════════════════════════════════════════════════════

KHÁCH HÀNG → Tạo order → QR Code → Thanh toán → PayOS Webhook
                                                       ↓
                                              [SERVER TỰ ĐỘNG]
                                                       ↓
                                         ┌─────────────┴──────────────┐
                                         ↓                            ↓
                                  Tạo License Key              Gửi Email
                                         ↓                            ↓
                                    Lưu Database          Email đến khách hàng
                                         ↓                            
                                   HOÀN TẤT! 🎉


════════════════════════════════════════════════════════════════════════════
    📊 BẢNG GIÁ
════════════════════════════════════════════════════════════════════════════

Plan        Giá (VND)     Thời hạn
────────────────────────────────────────────────────────────────────────────
Monthly     49,000        30 ngày
Yearly      99,000        365 ngày
Lifetime    199,000       Vĩnh viễn


════════════════════════════════════════════════════════════════════════════
    🔗 USEFUL LINKS
════════════════════════════════════════════════════════════════════════════

🌐 Render Dashboard:
   https://dashboard.render.com

💳 PayOS Dashboard:
   https://my.payos.vn/

📧 Admin Panel (tạo license thủ công):
   https://ocr-uufr.onrender.com/admin

🔍 Check PayOS Config:
   https://ocr-uufr.onrender.com/api/debug/payos-config

🔍 Check Email Config:
   https://ocr-uufr.onrender.com/api/debug/email-config

📜 Render Logs:
   https://dashboard.render.com/web/YOUR_SERVICE/logs


════════════════════════════════════════════════════════════════════════════
    🧪 TEST ENDPOINTS
════════════════════════════════════════════════════════════════════════════

1. Kiểm tra PayOS config:
   curl https://ocr-uufr.onrender.com/api/debug/payos-config

2. Tạo payment link:
   curl -X POST https://ocr-uufr.onrender.com/api/payment/payos/create \
     -H "Content-Type: application/json" \
     -d '{"plan_type":"lifetime","customer_email":"hoangtuan.th484@gmail.com"}'

3. Kiểm tra order:
   curl https://ocr-uufr.onrender.com/api/orders/{order_id}

4. Test email:
   curl -X POST https://ocr-uufr.onrender.com/api/debug/test-email \
     -H "Content-Type: application/json" \
     -d '{"to_email":"hoangtuan.th484@gmail.com"}'


════════════════════════════════════════════════════════════════════════════
    ⚠️ TROUBLESHOOTING
════════════════════════════════════════════════════════════════════════════

Lỗi: "payos_enabled": false
├─ Nguyên nhân: Environment variables chưa được set
└─ Giải pháp: Làm lại Bước 1, đảm bảo Save Changes và chờ deploy

Lỗi: "PayOS not initialized"
├─ Nguyên nhân: Credentials sai hoặc PayOS service down
└─ Giải pháp: Check logs, verify credentials trên PayOS dashboard

Webhook không được gọi:
├─ Nguyên nhân: Webhook URL chưa đăng ký trên PayOS
└─ Giải pháp: Làm lại Bước 2, verify webhook URL đã lưu

Email không gửi:
├─ Nguyên nhân: Email config chưa setup
└─ Giải pháp: Đọc QUICK_START.md để setup email


════════════════════════════════════════════════════════════════════════════
    ✅ CHECKLIST
════════════════════════════════════════════════════════════════════════════

Setup (Anh cần làm):
  ☐ Thêm 3 env vars vào Render (PAYOS_CLIENT_ID, API_KEY, CHECKSUM_KEY)
  ☐ Save → Chờ deploy (2-3 phút)
  ☐ Vào PayOS Dashboard → Thêm Webhook URL
  ☐ Enable webhook events (Payment Success, etc.)
  ☐ Test: curl /api/debug/payos-config → Verify "payos_enabled": true
  ☐ Test: Chạy test_payos_payment.ps1
  ☐ Test: Thanh toán thực tế với QR code
  ☐ Verify: Email nhận được

Đã hoàn thành (Code):
  ✅ PayOS integration code
  ✅ Webhook handler
  ✅ Auto license generation
  ✅ Auto email sending
  ✅ Test scripts
  ✅ Documentation


════════════════════════════════════════════════════════════════════════════
    🎉 SAU KHI SETUP XONG
════════════════════════════════════════════════════════════════════════════

HỆ THỐNG SẼ TỰ ĐỘNG:

✅ Nhận thanh toán từ PayOS (QR Code / Checkout URL)
✅ Tạo license key ngay khi thanh toán thành công
✅ Gửi email với license key đến khách hàng
✅ Cập nhật database (orders + licenses)
✅ Hoàn toàn tự động - KHÔNG CẦN can thiệp thủ công!


════════════════════════════════════════════════════════════════════════════
    💡 TIP
════════════════════════════════════════════════════════════════════════════

• Test với số tiền nhỏ trước (hoặc PayOS sandbox nếu có)
• Monitor Render logs sau khi thanh toán để track webhook
• Đọc PAYOS_SETUP_GUIDE.md để hiểu chi tiết flow


════════════════════════════════════════════════════════════════════════════

Tạo: 2024-10-22
Status: ⏳ Waiting for PayOS Environment Variables Setup
Next: Làm theo Bước 1 → Add env vars to Render

════════════════════════════════════════════════════════════════════════════

